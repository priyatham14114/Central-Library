sap.ui.define(["sap/ui/core/mvc/Controller","sap/m/MessageToast","sap/ui/model/json/JSONModel","sap/m/Token","sap/ui/model/Filter","sap/ui/model/FilterOperator"],function(e,t,s,n,o,i){"use strict";return e.extend("com.app.centrallibrary.controller.userView",{onInit:function(){const e=new s({ReservedUserName:"",ReservedUserId:"",ReservedBook:""});this.getView().setModel(e,"newReservationModel");const t=this.getOwnerComponent().getRouter();t.attachRoutePatternMatched(this.onCurrentUserDetails,this)},onCurrentUserDetails:function(e){const{userId:t}=e.getParameter("arguments");this.ID=t;const s=e.getParameter("name");const n=this.getView().byId("idUserDataPage");n.bindElement(`/UserLogin(${t})`,{expand:""})},onLogoutPress:function(){debugger;const e=this.getOwnerComponent().getRouter();e.navTo("RouteloginView",{},true)},onRefresh:function(){this.getView().byId("idBooksTable").getBinding("items").refresh()},onUserRefresh:function(){this.getView().byId("idUserActiveLoanTable").getBinding("items").refresh()},onReserveBookPress:async function(){debugger;const e=this.getView();var s=this.byId("idBooksTable").getSelectedItem();if(s){var n=s.getBindingContext().getObject().availableQuantity,r=s.getBindingContext().getObject().title,a=e.byId("idUserName").getText(),d=e.byId("idUserIdLink").getText();if(n==="0"){var g=this.getView().getModel();var l=g.bindList("/Reservations");l.filter([new o("ReservedUserId",i.EQ,d),new o("ReservedBook",i.EQ,r)]);l.requestContexts().then(function(s){if(s.length>0){t.show("You already reserved this Book")}else{const s=e.getModel().bindList("/Reservations");s.create({ReservedUserName:a,ReservedUserId:d,ReservedBook:r});t.show("Reservation Sent to Admin")}})}else{t.show("Book is available you don't need to reserve")}}else{t.show("Select a book to reserve")}},onFilterCilck:function(){debugger;const e=this.getView(),t=e.byId("idUserActiveLoanTable"),s=e.byId("idUserInputValue").getValue();var n=[];s?n.push(new o("borrowingBookName",i.EQ,s)):"";t.getBinding("items").filter(n)}})});